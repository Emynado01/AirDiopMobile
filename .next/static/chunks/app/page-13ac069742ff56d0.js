(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4708:function(e,a,t){Promise.resolve().then(t.bind(t,2389))},2389:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return T}});var r=t(7437),s=t(2265),l=t(6561),i=t(3774),n=t(9584),o=t(1047),c=t(5805),d=t(3247);let x=e=>{let{onSearch:a}=e,[t,l]=(0,s.useState)({from:"",to:"",departureDate:void 0,returnDate:void 0,passengers:1,isRoundTrip:!1}),x=e=>e?e.toISOString().split("T")[0]:"";return(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,r.jsx)("button",{onClick:()=>l(e=>({...e,isRoundTrip:!1})),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(t.isRoundTrip?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-sky-500 text-white"),children:"Aller simple"}),(0,r.jsx)("button",{onClick:()=>l(e=>({...e,isRoundTrip:!0})),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(t.isRoundTrip?"bg-sky-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Aller-retour"})]}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(t)},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"De"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(i.Z,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:t.from,onChange:e=>l(a=>({...a,from:e.target.value})),placeholder:"Ville de d\xe9part",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",required:!0})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vers"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(i.Z,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:t.to,onChange:e=>l(a=>({...a,to:e.target.value})),placeholder:"Ville d'arriv\xe9e",className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",required:!0}),(0,r.jsx)("button",{type:"button",onClick:()=>{l(e=>({...e,from:e.to,to:e.from}))},className:"absolute right-3 top-3 p-1 text-gray-400 hover:text-sky-500 transition-colors",children:(0,r.jsx)(n.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"D\xe9part"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.Z,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,r.jsx)("input",{type:"date",value:x(t.departureDate),onChange:e=>l(a=>({...a,departureDate:e.target.value?new Date(e.target.value):void 0})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",required:!0})]})]}),t.isRoundTrip&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Retour"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.Z,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,r.jsx)("input",{type:"date",value:x(t.returnDate),onChange:e=>l(a=>({...a,returnDate:e.target.value?new Date(e.target.value):void 0})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",min:x(t.departureDate)})]})]}),(0,r.jsxs)("div",{className:t.isRoundTrip?"":"lg:col-start-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Passagers"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,r.jsx)("select",{value:t.passengers,onChange:e=>l(a=>({...a,passengers:Number(e.target.value)})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsxs)("option",{value:e,children:[e," ",1===e?"passager":"passagers"]},e))})]})]})]}),(0,r.jsx)("div",{className:"flex justify-center pt-4",children:(0,r.jsxs)("button",{type:"submit",className:"flex items-center space-x-2 px-8 py-3 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition-colors font-medium",children:[(0,r.jsx)(d.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"Rechercher des vols"})]})})]})]})};var u=t(740);let m=e=>{let{filters:a,onFiltersChange:t,airlines:s,maxPrice:l}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 text-gray-600"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtres"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trier par"}),(0,r.jsxs)("select",{value:"".concat(a.sortBy,"-").concat(a.sortOrder),onChange:e=>{let[r,s]=e.target.value.split("-");t({...a,sortBy:r,sortOrder:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[(0,r.jsx)("option",{value:"price-asc",children:"Prix croissant"}),(0,r.jsx)("option",{value:"price-desc",children:"Prix d\xe9croissant"}),(0,r.jsx)("option",{value:"duration-asc",children:"Dur\xe9e croissante"}),(0,r.jsx)("option",{value:"duration-desc",children:"Dur\xe9e d\xe9croissante"}),(0,r.jsx)("option",{value:"departure-asc",children:"D\xe9part t\xf4t"}),(0,r.jsx)("option",{value:"departure-desc",children:"D\xe9part tard"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Prix maximum: ",a.maxPrice||l,"€"]}),(0,r.jsx)("input",{type:"range",min:"0",max:l,value:a.maxPrice||l,onChange:e=>t({...a,maxPrice:Number(e.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Escales maximum"}),(0,r.jsxs)("select",{value:a.maxStops||"",onChange:e=>t({...a,maxStops:e.target.value?Number(e.target.value):void 0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500",children:[(0,r.jsx)("option",{value:"",children:"Toutes"}),(0,r.jsx)("option",{value:"0",children:"Vol direct"}),(0,r.jsx)("option",{value:"1",children:"Maximum 1 escale"}),(0,r.jsx)("option",{value:"2",children:"Maximum 2 escales"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Compagnies"}),(0,r.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:s.map(e=>{var s;return(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:(null===(s=a.airlines)||void 0===s?void 0:s.includes(e))||!1,onChange:r=>{let s=a.airlines||[],l=r.target.checked?[...s,e]:s.filter(a=>a!==e);t({...a,airlines:l.length>0?l:void 0})},className:"w-4 h-4 text-sky-600 bg-gray-100 border-gray-300 rounded focus:ring-sky-500"}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:e})]},e)})})]})]})]})};var h=t(6381),g=t(1723),p=t(2135),f=t(875),v=t(2514),y=t(3004);let b=e=>{var a,t,l;let{flight:n,onSelect:o}=e,[d,x]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null),[b,j]=(0,s.useState)(!1),N=async()=>{x(!0),m(null);try{let e=await fetch("/api/user-status",{credentials:"include"});if(!e.ok)throw Error("Utilisateur non connect\xe9.");let{user:a}=await e.json();if(!(null==a?void 0:a.id))throw Error("Impossible de r\xe9cup\xe9rer l'identit\xe9 utilisateur.");let t=await fetch("/api/reservation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,flightId:n.flightNumber,airline:n.airline,departure:"".concat(n.from," - ").concat((0,v.WU)(new Date(n.departureDate),"yyyy-MM-dd HH:mm")),arrival:"".concat(n.to," - ").concat((0,v.WU)(new Date(n.arrivalDate),"yyyy-MM-dd HH:mm"))})}),r=await t.json();if(!r.success)throw Error(r.error||"\xc9chec de la r\xe9servation.");m("R\xe9servation r\xe9ussie !")}catch(e){m(e.message||"Erreur lors de la r\xe9servation.")}finally{x(!1)}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 p-6 mb-4",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-sky-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(h.Z,{className:"w-4 h-4 text-sky-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-gray-900",children:n.airline}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:n.flightNumber})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,r.jsx)("span",{children:n.aircraft}),(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{children:[n.availableSeats," places"]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,v.WU)(new Date(n.departureDate),"HH:mm")}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:(0,v.WU)(new Date(n.departureDate),"dd MMM",{locale:y.fr})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:n.from})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),(0,r.jsx)("div",{className:"flex-1 h-0.5 bg-gray-300"}),(0,r.jsx)(h.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("div",{className:"flex-1 h-0.5 bg-gray-300"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-700 flex items-center space-x-1",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:(t=n.duration,"".concat(Math.floor(t/60),"h ").concat(t%60,"m"))})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:0===(l=n.stops)?"Direct":1===l?"1 escale":"".concat(l," escales")})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 justify-end",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:n.to})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,v.WU)(new Date(n.arrivalDate),"HH:mm")}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:(0,v.WU)(new Date(n.arrivalDate),"dd MMM",{locale:y.fr})})]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end space-y-2 lg:ml-6",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:[n.price,"€"]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"par personne"})]}),(0,r.jsx)("button",{onClick:N,disabled:d,className:"px-6 py-3 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition-colors font-medium",children:"S\xe9lectionner"}),u&&(0,r.jsx)("div",{className:"mt-2 text-sm text-center",style:{color:"R\xe9servation r\xe9ussie !"===u?"green":"red"},children:u})]}),(0,r.jsx)("button",{onClick:()=>j(e=>!e),className:"ml-4 p-2 focus:outline-none","aria-label":"Afficher plus d'informations",children:b?(0,r.jsx)(p.Z,{className:"w-6 h-6 text-gray-600"}):(0,r.jsx)(f.Z,{className:"w-6 h-6 text-gray-600"})})]}),b&&(0,r.jsxs)("div",{className:"mt-4 bg-gray-50 rounded p-4 text-sm text-gray-700 transition-all",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Statut du vol"}),": ",n.status||"Non disponible"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Mod\xe8le avion"}),": ",n.aircraft]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Terminal d\xe9part"}),": ",n.departureTerminal||"?"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Porte d embarquement"}),": ",n.departureGate||"?"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Retard au d\xe9part"}),": ",null!==(a=n.departureDelay)&&void 0!==a?a:"?"," min"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Porte d arriv\xe9e"}),": ",n.arrivalGate||"?"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Baggage"}),": ",n.arrivalBaggage||"?"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Position actuelle"}),": ",n.latitude&&n.longitude?"".concat(n.latitude,", ").concat(n.longitude):"Non disponible"]})]})]})},j=e=>{let{flights:a,loading:t,onSelectFlight:s}=e;return t?(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-sky-500"}),(0,r.jsx)("span",{className:"ml-3 text-gray-600",children:"Recherche des vols..."})]}):0===a.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(d.Z,{className:"w-8 h-8 text-gray-400"})})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucun vol trouv\xe9"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Essayez de modifier vos crit\xe8res de recherche ou vos filtres."})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:[a.length," vol",a.length>1?"s":""," trouv\xe9",a.length>1?"s":""]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Tarifs incluant taxes et frais"})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,r.jsx)(b,{flight:e,onSelect:s},e.id))})]})},N="59ef4b5f9a55ec74e42c1b4404b7d227";async function k(e){if(!N)throw Error("Cl\xe9 API AviationStack manquante. Veuillez configurer NEXT_PUBLIC_FLIGHT_API_KEY dans votre fichier .env.local");let a={access_key:N,limit:"100"};e.dep_iata&&(a.dep_iata=e.dep_iata),e.arr_iata&&(a.arr_iata=e.arr_iata),e.flight_status&&(a.flight_status=e.flight_status);let t=new URLSearchParams(a);try{let e=await fetch("".concat("https://api.aviationstack.com/v1","/flights?").concat(t)),a=await e.json();if(!e.ok){var r;throw Error((null===(r=a.error)||void 0===r?void 0:r.message)||"Erreur API: ".concat(e.status))}if(a.error)throw Error(a.error.message||"Erreur API inconnue");return a.data||[]}catch(e){throw console.error("Erreur lors de la recherche de vols:",e),e}}let w={CDG:"Paris",ORY:"Paris",LHR:"Londres",LGW:"Londres",JFK:"New York",LAX:"Los Angeles",DXB:"Duba\xef",NRT:"Tokyo",HND:"Tokyo",SYD:"Sydney",FRA:"Francfort",AMS:"Amsterdam",MAD:"Madrid",FCO:"Rome",IST:"Istanbul",SIN:"Singapour",HKG:"Hong Kong",BCN:"Barcelone",MUC:"Munich",ZUR:"Zurich",VIE:"Vienne",BRU:"Bruxelles",CPH:"Copenhague",ARN:"Stockholm",OSL:"Oslo",HEL:"Helsinki",ATH:"Ath\xe8nes",DUB:"Dublin",SVO:"Moscou",VKO:"Moscou",LED:"Saint-P\xe9tersbourg",GVA:"Gen\xe8ve",LIS:"Lisbonne",PRG:"Prague",WAW:"Varsovie",BUD:"Budapest",KBP:"Kyiv",DME:"Moscou",DOH:"Doha",JNB:"Johannesburg",CAI:"Le Caire",CMN:"Casablanca",ALG:"Alger",NBO:"Nairobi",CPT:"Le Cap",MEX:"Mexico",GRU:"S\xe3o Paulo",EZE:"Buenos Aires",YYZ:"Toronto",YVR:"Vancouver",YUL:"Montr\xe9al",SFO:"San Francisco",MIA:"Miami",ORD:"Chicago",SEA:"Seattle",BOM:"Mumbai",DEL:"Delhi",PEK:"P\xe9kin",PVG:"Shanghai",ICN:"S\xe9oul",KUL:"Kuala Lumpur",BKK:"Bangkok",MEL:"Melbourne",AKL:"Auckland",AUH:"Abu Dhabi",JED:"Djeddah",RUH:"Riyad",LIM:"Lima",SCL:"Santiago",LGA:"New York (LaGuardia)",EWR:"New York (Newark)",TXL:"Berlin",TLV:"Tel Aviv"};function D(e){try{var a,t,r,s,l,i,n,o,c,d,x,u,m,h,g,p;if(!(null===(a=e.departure)||void 0===a?void 0:a.iata)||!(null===(t=e.arrival)||void 0===t?void 0:t.iata)||!(null===(r=e.airline)||void 0===r?void 0:r.name))return null;let f=new Date(e.departure.scheduled||e.departure.estimated),v=new Date(e.arrival.scheduled||e.arrival.estimated);if(isNaN(f.getTime())||isNaN(v.getTime()))return null;let y=function(e,a){if(!e||!a)return 120;let t=new Date(e),r=new Date(a);return isNaN(t.getTime())||isNaN(r.getTime())?120:Math.max(Math.round((r.getTime()-t.getTime())/6e4),30)}(e.departure.scheduled||e.departure.estimated,e.arrival.scheduled||e.arrival.estimated),b=function(e,a){let t=a.toLowerCase().includes("emirates")||a.toLowerCase().includes("qatar")?1.5:1;return Math.round(Math.max(.8*e,150)*t*(.8+.4*Math.random()))}(y,e.airline.name),j=y<180?0:y<480?.7>Math.random()?0:1:y<720?.5>Math.random()?1:2:Math.floor(2*Math.random())+1;return{id:"".concat(e.flight.iata||e.flight.number,"-").concat(e.flight_date),airline:e.airline.name,flightNumber:e.flight.iata||e.flight.number,from:w[g=e.departure.iata]||g,to:w[p=e.arrival.iata]||p,departureDate:f,arrivalDate:v,price:b,duration:y,stops:j,aircraft:(null===(s=e.aircraft)||void 0===s?void 0:s.iata)||"N/A",availableSeats:Math.floor(200*Math.random())+50,status:e.flight_status||"",departureTerminal:(null===(l=e.departure)||void 0===l?void 0:l.terminal)||"",departureGate:(null===(i=e.departure)||void 0===i?void 0:i.gate)||"",departureDelay:null!==(u=null===(n=e.departure)||void 0===n?void 0:n.delay)&&void 0!==u?u:null,arrivalGate:(null===(o=e.arrival)||void 0===o?void 0:o.gate)||"",arrivalBaggage:(null===(c=e.arrival)||void 0===c?void 0:c.baggage)||"",latitude:null!==(m=null===(d=e.live)||void 0===d?void 0:d.latitude)&&void 0!==m?m:null,longitude:null!==(h=null===(x=e.live)||void 0===x?void 0:x.longitude)&&void 0!==h?h:null}}catch(e){return console.error("Erreur lors du mapping des donn\xe9es de vol:",e),null}}let S={paris:"CDG",londres:"LHR",london:"LHR","new york":"JFK",newyork:"JFK","los angeles":"LAX",losangeles:"LAX",dubai:"DXB",dubaï:"DXB",tokyo:"NRT",sydney:"SYD",francfort:"FRA",frankfurt:"FRA",amsterdam:"AMS",madrid:"MAD",rome:"FCO",istanbul:"IST",singapore:"SIN",singapour:"SIN","hong kong":"HKG",hongkong:"HKG",barcelone:"BCN",barcelona:"BCN",munich:"MUC",zurich:"ZUR",vienne:"VIE",vienna:"VIE",bruxelles:"BRU",brussels:"BRU",copenhague:"CPH",copenhagen:"CPH",milan:"MXP",milano:"MXP",berlin:"BER",stockholm:"ARN",oslo:"OSL",helsinki:"HEL"};function C(e){return S[e.toLowerCase().trim()]}let M=()=>{let[e,a]=(0,s.useState)([]),[t,r]=(0,s.useState)([]),[l,i]=(0,s.useState)(!1),[n,o]=(0,s.useState)(null);return{flights:t,loading:l,error:n,searchFlights:async e=>{i(!0),o(null);try{let t=C(e.from),s=C(e.to);if(!t||!s){let e=Object.keys(S).join(", ");throw Error("Ville non reconnue. Villes support\xe9es : ".concat(e.substring(0,100),"..."))}let l={dep_iata:t,arr_iata:s,limit:"50"};if(e.departureDate){let a=e.departureDate.toISOString().split("T")[0];l.flight_date=a}console.log("Recherche avec l'API AviationStack:",l);let i=(await k(l)).map(D).filter(e=>null!==e);console.log("API a retourn\xe9 ".concat(i.length," vols")),(i=i.filter(a=>a.availableSeats>=e.passengers)).sort((e,a)=>e.price-a.price),a(i),r(i),0===i.length&&o("Aucun vol trouv\xe9 pour ces crit\xe8res. Essayez une autre date ou d'autres villes.")}catch(e){console.error("Erreur lors de la recherche des vols:",e),o(e instanceof Error?e.message:"Erreur lors de la recherche des vols"),a([]),r([])}finally{i(!1)}},applyFilters:a=>{let t=[...e];void 0!==a.maxPrice&&(t=t.filter(e=>e.price<=a.maxPrice)),void 0!==a.maxStops&&(t=t.filter(e=>e.stops<=a.maxStops)),a.airlines&&a.airlines.length>0&&(t=t.filter(e=>a.airlines.includes(e.airline))),t.sort((e,t)=>{let r=0;switch(a.sortBy){case"price":r=e.price-t.price;break;case"duration":r=e.duration-t.duration;break;case"departure":r=new Date(e.departureDate).getTime()-new Date(t.departureDate).getTime()}return"desc"===a.sortOrder?-r:r}),r(t)},getUniqueAirlines:()=>Array.from(new Set(e.map(e=>e.airline))),getMaxPrice:()=>Math.max(...e.map(e=>e.price),0)}};var A=t(7648),E=t(9322);function L(){let[e,a]=(0,s.useState)(!1),[t,l]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{fetch("/api/user-status",{credentials:"include"}).then(e=>e.ok?e.json():{connected:!1}).then(e=>{e.connected||a(!0),l(!0)}).catch(()=>{a(!0),l(!0)})},[]),e&&t)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl p-8 max-w-sm w-full relative",children:[(0,r.jsx)("button",{onClick:()=>a(!1),className:"absolute top-3 right-4 text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl","aria-label":"Fermer"}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,r.jsx)(E.Z,{className:"w-12 h-12 text-yellow-400 mb-3"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-yellow-300 mb-2",children:"Non connect\xe9"}),(0,r.jsx)("p",{className:"text-gray-700 dark:text-gray-200 mb-5",children:"Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 cette fonctionnalit\xe9."}),(0,r.jsx)(A.default,{href:"/connexion",className:"inline-block px-6 py-2 bg-sky-500 hover:bg-sky-600 dark:bg-yellow-400 dark:hover:bg-yellow-500 text-white dark:text-blue-900 rounded-lg font-semibold shadow transition",children:"Se connecter"})]})]})}):null}let P=["/backgrounds/imgback01.jpg","/backgrounds/imgback02.jpeg","/backgrounds/imgback03.jpeg","/backgrounds/imgback04.jpeg","/backgrounds/imgback05.jpg"];function T(){let[e,a]=(0,s.useState)(!1),[t,i]=(0,s.useState)({sortBy:"price",sortOrder:"asc"}),[n,o]=(0,s.useState)(0);(0,s.useEffect)(()=>{let e=setInterval(()=>{o(e=>(e+1)%P.length)},5e3);return()=>clearInterval(e)},[]);let{flights:c,loading:d,error:u,searchFlights:g,applyFilters:p,getUniqueAirlines:f,getMaxPrice:v}=M(),y=(0,s.useCallback)(async e=>{await g(e),a(!0),p(t)},[g,p,t]),b=(0,s.useCallback)(a=>{i(a),e&&p(a)},[p,e]),N=(0,s.useCallback)(e=>{alert("Vol s\xe9lectionn\xe9 : ".concat(e.airline," ").concat(e.flightNumber," - ").concat(e.price,"€"))},[]);return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:[(0,r.jsx)(L,{}),(0,r.jsx)(l.Header,{}),(0,r.jsxs)("div",{className:"relative text-white py-16 transition-all duration-1000",style:{backgroundImage:"url(".concat(P[n],")"),backgroundSize:"cover",backgroundPosition:"center"},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-sky-900/50 dark:bg-black/60 pointer-events-none transition-colors"}),(0,r.jsxs)("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"text-center mb-12",children:[(0,r.jsx)("h1",{className:"text-4xl lg:text-5xl font-bold mb-4 drop-shadow-lg dark:text-yellow-100",children:"Trouvez votre vol id\xe9al"}),(0,r.jsx)("p",{className:"text-xl text-sky-100 max-w-2xl mx-auto dark:text-yellow-50",children:"Comparez les prix de centaines de compagnies a\xe9riennes et trouvez les meilleures offres pour votre prochain voyage."})]}),(0,r.jsx)(x,{onSearch:y})]})]}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u&&(0,r.jsx)("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-100 px-4 py-3 rounded mb-6 transition-colors",children:u}),e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m,{filters:t,onFiltersChange:b,airlines:f(),maxPrice:v()}),(0,r.jsx)(j,{flights:c,loading:d,onSelectFlight:N})]}):(0,r.jsxs)("div",{className:"text-center py-16",children:[(0,r.jsx)("div",{className:"flex justify-center mb-6",children:(0,r.jsx)("div",{className:"w-20 h-20 bg-sky-100 dark:bg-gray-800 rounded-full flex items-center justify-center",children:(0,r.jsx)(h.Z,{className:"w-10 h-10 text-sky-500 dark:text-yellow-300"})})}),(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Pr\xeat \xe0 d\xe9coller ?"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300 max-w-md mx-auto",children:"Utilisez le formulaire de recherche ci-dessus pour trouver les meilleurs vols selon vos crit\xe8res."})]})]})]})}},6561:function(e,a,t){"use strict";t.d(a,{Header:function(){return m}});var r=t(7437),s=t(2265),l=t(2369),i=t(5929),n=t(7226),o=t(8293),c=t(7648),d=t(6012),x=t(6346);function u(){let[e,a]=(0,s.useState)(null);if((0,s.useEffect)(()=>{let e=e=>{e.preventDefault(),a(e)};return window.addEventListener("beforeinstallprompt",e),()=>window.removeEventListener("beforeinstallprompt",e)},[]),!e)return null;let t=async()=>{e.prompt();let{outcome:t}=await e.userChoice;"accepted"===t&&a(null)};return(0,r.jsxs)("button",{onClick:t,className:"flex items-center space-x-2 px-3 py-2 bg-sky-500 hover:bg-sky-600 text-white rounded-lg transition-colors",title:"Installer l'application",children:[(0,r.jsx)(x.Z,{className:"w-5 h-5"}),"+      ",(0,r.jsx)("span",{children:"Installer"}),"+    "]})}let m=()=>{let{connected:e,user:a}=function(){let[e,a]=(0,s.useState)(!1),[t,r]=(0,s.useState)(null);return(0,s.useEffect)(()=>{fetch("/api/user-status",{credentials:"include"}).then(async e=>{if(!e.ok)throw Error("Not authenticated");let t=await e.json();a(t.connected),r(t.user||null)}).catch(()=>{a(!1),r(null)})},[]),{connected:e,user:t}}(),[t,x]=(0,s.useState)(!1),{dark:m,toggleDark:h}=(0,s.useContext)(d.v),g=async()=>{await fetch("/api/logout",{method:"POST"}),window.location.href="/connexion"};return(0,r.jsxs)("header",{className:"bg-white dark:bg-gray-950 shadow-sm border-b border-gray-200 dark:border-gray-800 transition-colors",children:[(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-10 h-10 bg-sky-500 rounded-lg",children:(0,r.jsx)("img",{src:"/img/logoJet.png",alt:"Logo AirDiop",className:"w-8 h-8 object-contain"})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900 dark:text-yellow-100",children:"AirDiop"})]}),(0,r.jsxs)("nav",{className:"hidden md:flex items-center space-x-8",children:[(0,r.jsx)(c.default,{href:"/",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",children:"Vols"}),(0,r.jsx)(c.default,{href:"/tableau",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",children:"Tableau de bord"}),(0,r.jsx)(c.default,{href:"/about",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",children:"\xc0 propos"}),(0,r.jsx)(c.default,{href:"/decouverte",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",children:"D\xe9couverte"}),e&&(null==a?void 0:a.isAdmin)&&(0,r.jsx)(c.default,{href:"/admin",className:"text-red-500 hover:text-red-600",children:"Admin"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[e?(0,r.jsxs)("button",{onClick:g,className:"hidden md:flex items-center space-x-2 px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg transition-colors",children:[(0,r.jsx)(l.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"D\xe9connexion"})]}):(0,r.jsxs)(c.default,{href:"/connexion",className:"hidden md:flex items-center space-x-2 px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg transition-colors",children:[(0,r.jsx)(l.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"Connexion"})]}),(0,r.jsx)(u,{}),(0,r.jsx)("button",{onClick:h,className:"p-2 rounded-full transition bg-gray-200 dark:bg-gray-700",title:"Changer le mode d'affichage",children:m?(0,r.jsx)(i.Z,{className:"w-5 h-5 text-yellow-400"}):(0,r.jsx)(n.Z,{className:"w-5 h-5 text-gray-700"})}),(0,r.jsx)("button",{className:"md:hidden p-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg",onClick:()=>x(e=>!e),"aria-label":"Ouvrir le menu",children:(0,r.jsx)(o.Z,{className:"w-5 h-5"})})]})]})}),t&&(0,r.jsxs)("nav",{className:"md:hidden flex flex-col bg-white dark:bg-gray-950 px-4 py-2 rounded shadow space-y-2 mt-2",children:[(0,r.jsx)(c.default,{href:"/",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",onClick:()=>x(!1),children:"Vols"}),(0,r.jsx)(c.default,{href:"/tableau",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",onClick:()=>x(!1),children:"Tableau de bord"}),(0,r.jsx)(c.default,{href:"/about",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",onClick:()=>x(!1),children:"\xc0 propos"}),(0,r.jsx)(c.default,{href:"/decouverte",className:"text-gray-700 dark:text-gray-200 hover:text-sky-500 font-medium transition-colors",onClick:()=>x(!1),children:"D\xe9couverte"}),e&&(null==a?void 0:a.isAdmin)&&(0,r.jsx)(c.default,{href:"/admin",className:"text-red-500 hover:text-red-600",children:"Admin"}),!e&&(0,r.jsxs)(c.default,{href:"/connexion",className:"flex items-center space-x-2 px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg transition-colors",onClick:()=>x(!1),children:[(0,r.jsx)(l.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"Connexion"})]}),e&&(0,r.jsxs)("button",{onClick:()=>{x(!1),g()},className:"flex items-center space-x-2 px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg transition-colors",children:[(0,r.jsx)(l.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"D\xe9connexion"})]}),(0,r.jsx)(u,{}),(0,r.jsxs)("button",{onClick:h,className:"flex items-center space-x-2 px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900 rounded-lg transition-colors",title:"Changer le mode d'affichage",children:[m?(0,r.jsx)(i.Z,{className:"w-5 h-5 text-yellow-400"}):(0,r.jsx)(n.Z,{className:"w-5 h-5 text-gray-700"}),(0,r.jsxs)("span",{children:["Mode ",m?"Clair":"Sombre"]})]})]})]})}},6012:function(e,a,t){"use strict";t.d(a,{W:function(){return i},v:function(){return l}});var r=t(7437),s=t(2265);let l=(0,s.createContext)({dark:!1,toggleDark:()=>{}});function i(e){let{children:a}=e,[t,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{i("dark"===localStorage.getItem("theme"))},[]),(0,s.useEffect)(()=>{t?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},[t]),(0,r.jsx)(l.Provider,{value:{dark:t,toggleDark:()=>i(e=>!e)},children:a})}}},function(e){e.O(0,[216,780,971,117,744],function(){return e(e.s=4708)}),_N_E=e.O()}]);